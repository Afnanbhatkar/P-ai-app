<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Chat Application</title>
    <style>
        /* Your existing styles here */

        body {
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            overflow-x: hidden;
        }

        .sticky-top {
            position: fixed;
            top: 0;
            width: 100%;
            margin: 0px 0px 6px;
            background-color: white; /* Adjust background color with opacity */
            padding: 2px;
            color: black;
            z-index: 1000;
            backdrop-filter: blur(5px); /* Add backdrop filter for blur effect */
            transition: margin-left 1s;
        }

        .sticky-top h1 {
            margin-top: 14px;
            font-size: 18px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin-left: 21px;
            color: #000000;
        }

        .sticky-top span {
            color: #676767;
            margin-left: 5px;
        }

        .container {
            width: 100%;
            background-color: white;
            padding: 20px;
            transition: margin-left 0.5s;
        }

        .chat-container {
            left: 60%;
            max-width: 770px;
            margin-left: 30px;
            margin: 50px auto;
            background-color: white;
            border-radius: 20px;
            overflow: hidden;
        }

        .howcan {
            opacity: 0;
            transition: opacity 0.5s ease, margin-left 0.5s ease;
            height: 800px;
            width: 42%;
            margin-left: 36%;
            position: fixed;
            top: 0;
            left: 0;
            background-color: white;
            z-index: 4;
        }

        .howcan h2 {
            color: black;
            z-index: 5;
            margin-top: 5px;
            margin-left: 25%;
            font-weight: 500;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #web-logo {
            margin-top: 35%; 
            margin-left: 40%;
            width: 48px;
            height: 48px;
            
        }

        /* Add styles for the sidebar */
        .sidebar {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: 	#f5f5f5;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 60px;
        }

        .sidebar a {
            
            text-decoration: none;
            padding-left: 10px;
            margin-left: 12px;
            margin-top: 8px;
            font-size: 14px;
            color: #0a0a0a;
            display: block;
            transition: 0.3s;

        }

        .Newchat {
            display: flex;
            width: 200px;
            align-items: center;
            padding-top: 5px;
            padding-bottom: 5px;
            text-align: 20px;
            text-decoration: none;
            font-size: 15px;
            color: black;
            margin-top: -43px;
            margin-left: 12px;
            border-radius: 5px;
            transition: 0.5s;
        }

        .Newchat:hover {
            background-color: #d6d6db;
        }

        .gpt {
            padding: 2px;
            margin-left: 10px;
            margin-right: 15px;
            line-height: 50px;
            width: 20px;
            height: 20px;
        }

        .days {
            padding-left: 10px;
            margin-left: 10px;
            margin-top: 30px;
            font-size: 13px;
            color: #818181;
        }

        .text {
            background-color: #ccc;
            padding: 10px;
            margin-top: -6px;
            border: 0 solid #e3e3e3;
            width: 210px;
            border-radius: 5px;
            transition: 0.3s;
        }

        .sidebar .closebtn {
            position: absolute;
            color: rgba(124, 123, 123, 0.788);
            top: 45%;
            right: 10px;
            font-size: 25px;
            margin-left: 50px; 
            transition: 0.3s;
        }

        .closebtn:hover {
            color: black;
            cursor: pointer;
            transform: scale(1.2);
        }

        .open-btn {
            color: rgba(124, 123, 123, 0.788);
            position: fixed;
            left: 20px;
            top: 50%;
            font-size: 25px;
            cursor: pointer;
            z-index: 1;
            transition: 0.3s; /* Smooth transition on hover */
        }

        .open-btn:hover {
            transform: scale(1.2); /* Example: Increase the size on hover */
            color: black;
        }

        .spacer {
            height: 10px;
        }
        
        body {
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
        }

       
        .chat-header {
            background-color: rgb(249, 248, 250);
            color: #fff;
            padding: 15px;
            text-align: center;
            border-bottom: 2px solid #2980b9;
        }

        .chat-box {
            padding: 15px;
            height: 800px;
            max-height: 765px;
            overflow-y: auto;
        }

        .user-input {
    display: flex;
    height: 40px;
    padding: 10px;
    align-items: center; /* Align items vertically */
}

#userInput {
    flex: 1; /* Take remaining space */
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 20px;
    margin-right: 10px;
    outline: none;
    width: 100px;
}

#sendButton {
    background-color: gray;
    color: #fff;
    border: none;
    padding: 8px 15px;
    cursor: pointer;
    border-radius: 30px;
    outline: none;
    margin-left: -120px;
    transition: background-color 0.3s ease;
}

        .voice-input-button {
            background-color: #fff;
            color: #ccc;
            border: none;
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 30px;
            margin-left: 10px;
            outline: none;
        }

        .voice-icon {
            width: 16px;
            height: 24px;
            margin-right: 2px;
        }

        .message {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            word-wrap: break-word;
        }

        .user {
            color: MediumPurple;
            text-align: right;
            padding: 5px;
            word-wrap: break-word;
        }

        .bot {
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            background-color: whitesmoke;
            border-radius: 7px;
            margin-top: 10px;
            color: #333;
            text-align: left;
            padding: 5px;
            width: 550px;
        }

        .typing-animation {
            display: inline-block;
            overflow: hidden;
            vertical-align: bottom;
            animation: show 0.7s infinite;
        }

        /* Scrollbar for the chat-box */
        .chat-box::-webkit-scrollbar {
            width: 8px;
        }

        .chat-box::-webkit-scrollbar-thumb {
            background-color: #3498db;
            border-radius: 10px;
        }

        .chat-box::-webkit-scrollbar-track {
            background-color: #f5f5f5;
        }

        .chat-box::-webkit-scrollbar-thumb:hover {
            background-color: #2980b9;
        }

        .spacer {
            height: 10px;
        }

        #midcontainer {
            width: 6%;
            background-color: white;
            transition: margin-left 0.5s;
        }

        #midcontainer h4 {
            margin-left: 10px;
            transition: 0.5s;
            padding: 5px;
            width: 60px;
            border-radius: 5px;
            cursor: pointer;
        }   

        #midcontainer h4:hover {
            background-color: 	#f5f5f5;
        }

        .disclaimer {
            margin-top: -17px;
            margin-left: 150px;
            font-size: 12px;
            color: rgb(95, 91, 91);
        }

        /* Add a modal overlay style */
        .modal-overlay {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        /* Add a style for the user section in the sidebar */
        #userSection {
            margin-bottom: 40px;
            display: none;
            position: absolute;
            bottom: 0;
            width: 100%;
            padding: 10px;
            background-color: #f5f5f5;
        }

        #logoutBtn {
    padding-left: 5px;
    text-align: center;
    width: 10px;
    position: fixed;
    overflow: hidden;
    padding: 5px;
    left: 1580px;
    margin-top: 10px;
    border-radius: 10px;
    cursor: pointer;
    color: black;
    background-color: #ddd;
    transition: all 0.3s ease-in-out;
}

#logoutBtn:hover {
    left: 1560px;
    color: white;
    background-color: black;
    width: 64px;
}

#logoutBtn:hover .img {
    left: 1560px;
}

#logoutBtn:hover #L {
    opacity: 1;
}

.img {
    opacity: 1;
    width: 15px;
    height: 15px;
    margin-top: 0px;
    position: fixed;
    left: 1585px;
    transition: all 0.4s ease;
}

        #L {
            transition: opacity 0.4s ease;
            opacity: 0;
            color: white;
        }        

        .Newchat.active {
            background-color: white;
        }
        
        .new-chat-text {
        background-color: #ccc;
        padding: 10px;
        margin-top: -6px;
        border: 0 solid #e3e3e3;
        width: 210px;
        border-radius: 5px;
        transition: 0.5s;
        margin-top: 5px;
        transition: background-color 0.5s ease;
        position: relative; 
        }

        .new-chat-text:hover {
         background-color: #ddd; 
        }

        .delete-icon {
        display: none; 
        position: absolute; 
        width: 15px;
        height: 15px; 
        right: 5px; 
        }

        .new-chat-text:hover .delete-icon {
          display: inline; 
        }

        #currentchat {
            transition: background-color 0.5s ease;
        }

        .displaychat {
            margin-top: 50px;
        }

        .page {
            height: 100%;
            width: 0;
            position: fixed;
            top: 0;
            left: 0;
            background-color: #ccc;
            transition: width 0.5s ease;
            z-index: 5;
            filter: blur(5px);
        }
        .page1 {
            height: 100%;
            width: 0;
            position: fixed;
            top: 0;
            right: 0; /* Set the 'right' property to position it on the right side */
            background-color: #ccc;
            transition: width 0.5s ease;
            z-index: 5;
            filter: blur(5px);
        }

        @keyframes show {
            0% {
                visibility: hidden;
            }
            49% {
                visibility: hidden;
            }
            50% {
                visibility: visible;
            }
            100% {
                visibility: visible;
            }
        }
    </style>
</head>
<body>
    <div class="howcan" id="howcan">
        <img id="web-logo" src="https://cdn-icons-png.flaticon.com/128/165/165406.png" alt="web-logo">
       <h2>How can i help you today?</h2>
    </div>
    <div class="page" id="page">
    </div>
    <div class="page1" id="page1">
    </div>
    <div class="modal-overlay" id="nameModal">
        <div class="overlay"></div>
        <div class="modal">
            <label for="username">Enter your name:</label>
            <input type="text" id="username">
            <button onclick="login()">Login</button>
        </div>
    </div>
    <div class="sticky-top" id="sticky-top">
        <!-- Add your content for the sticky top section here -->
        <p id="logoutBtn" onclick="logout(), hidehowcan()"><img class="img" id="img" src="https://cdn-icons-png.flaticon.com/128/14266/14266282.png"><span id="L">L</span>ogout</p>
        <h1>Jarvis<span>1.2</span></h1>

    </div>

    <!-- Open Button -->
    <div class="open-btn" onmouseover="hoverOpenBtn()" onmouseout="unhoverOpenBtn()" onclick="openNav()">❱</div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <p href="javascript:void(0)" class="closebtn" onclick="closeNav()">❰</p>
        
        <p class="Newchat" onclick="resetChat(), handleNewChatClick() , Newchatcreated(), newchattext()"><img class="gpt" src="https://cdn-icons-png.flaticon.com/128/165/165406.png">    𝖭𝖾𝗐 𝖼𝗁𝖺𝗍</p>
        <p class="days">Today</p>
        <a class="text" id="currentchat">Currentchat</a>
        <!-- Add more sidebar items as needed -->
        <div id="userSection">
            <p id="loggedInUser"></p>
        </div>
    </div>
 
    <div class="container" id="mainContainer">
        <!-- Your content goes here -->
        <div class="chat-container">
            <div class="chat-box" id="chatBox">
                <!-- Chat messages will be displayed here -->
            </div>
            <div class="user-input" id="user-input">
                <input type="text" id="userInput" placeholder="Message Piai...">
                <button onclick="sendMessage()" id="sendButton">Send</button>
                <button class="voice-input-button" onclick="startVoiceRecognition()"></button>
            </div>
            <div class="disclaimer" id="disclaimer">
                <p>Piai can make mistakes. Consider checking important information.</p>
            </div>
        </div>
    </div>

    <script>    

    var Logouticon = document.getElementById("img");
    Logouticon.addEventListener('mouseover', function() {
        
    })
        // Set the initial width of the sidebar to 13.5%
        document.getElementById("mainContainer").style.marginLeft = "13.5%";
        document.getElementById("sidebar").style.width = "13.5%";
        document.getElementById("sticky-top").style.marginLeft = "13.5%";

     function loginslideopen() {
        document.getElementById("page").style.width = "50%";
     }

     function loginslideclose() {
        document.getElementById("page").style.width = "0";
     }

     function loginslideopenRight() {
    document.getElementById("page1").style.width = "50%";
}

function loginslidecloseRight() {
    document.getElementById("page1").style.width = "0";
}


        // Function to display welcome message if the user is logged in
     function displayWelcomeIfLoggedIn() {
      // Check if the user is logged in
     var loggedInUser = localStorage.getItem('loggedInUser');
     if (loggedInUser) {
        var chatBox = document.getElementById('chatBox');

        // Simulate AI typing before showing the welcome message
        simulateTyping();

        // Display the welcome message with typing animation
        displayWithTyping('bot', 'Welcome back, ' + loggedInUser + '! How can I assist you today?');

        // Stop simulating typing after showing the welcome message
        stopTyping();

        // Scroll to the bottom to show the latest message
        chatBox.scrollTop = chatBox.scrollHeight;
     }
     }

     // Call this function to display the welcome message if the user is logged in
     displayWelcomeIfLoggedIn();
             
        function displayWelcomeMessage2() {
            var chatBox = document.getElementById('chatBox');

            // Simulate AI typing before showing the welcome message
            simulateTyping();

            // Display the welcome message with typing animation
            displayWithTyping('bot', 'Logged in 🔗 Welcome sir, how can I help you?');

            // Stop simulating typing after showing the welcome message
            stopTyping();

            // Scroll to the bottom to show the latest message
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function Newchatcreated() {
            var chatBox = document.getElementById('chatBox');

            // Simulate AI typing before showing the welcome message
            simulateTyping();

            // Display the welcome message with typing animation
            displayWithTyping('bot', 'You created Newchat , how can I help you?');

            // Stop simulating typing after showing the welcome message
            stopTyping();

            // Scroll to the bottom to show the latest message
            chatBox.scrollTop = chatBox.scrollHeight;
        }    

        function showhowcan() {
            document.getElementById("howcan").style.opacity = "1";
        }

        function hidehowcan() {
            document.getElementById("howcan").style.opacity = "0";
        }

        // Add an event listener for the DOMContentLoaded event
        document.addEventListener('DOMContentLoaded', function () {
          // Call hidehowcan() after the page is loaded
          hidehowcan();
          
        });

        // Get the user input field and the send button
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');

        // Add event listener to the user input field
        userInput.addEventListener('input', function() {
            // Check if the user input is empty
            if (userInput.value.trim() === '') {
                // If input is empty, set the background color of send button to gray
                sendButton.style.backgroundColor = 'gray';
            } else {
                // If input is not empty, set the background color of send button to black
                sendButton.style.backgroundColor = 'black';
            }
        });

    // Initialize newChatCounter from localStorage or set it to 1
    var newChatCounter = parseInt(localStorage.getItem('newChatCounter')) || 1;
    // Restore chatData from localStorage or set it to an empty array
    var chatData = JSON.parse(localStorage.getItem('chatData')) || [];
    
    // ...

    function handleNewChatClick() {
    // Remove the 'active' class and background color from the previously active "New Chat" text
    var activeNewChat = document.querySelector('.new-chat-text.active');
    if (activeNewChat) {
        activeNewChat.classList.remove('active');
        activeNewChat.style.backgroundColor = ''; // Reset background color
        activeNewChat.style.border = "";
    }

    // Create an object to store chat details
    var chatDetails = {
        name: 'New Chat ' + newChatCounter,
        counter: newChatCounter
    };

    if (newChatCounter <= 10) {
        // Add "New Chat" text above sidebar item 2
        var newChatText = document.createElement('div');
        newChatText.classList.add('days', 'new-chat-text', 'active');
        newChatText.innerHTML = chatDetails.name;
        newChatCounter++;

        // Create delete icon
        var deleteIcon = document.createElement('img');
        deleteIcon.src = 'https://cdn-icons-png.flaticon.com/128/9321/9321240.png';
        deleteIcon.classList.add('delete-icon');
        deleteIcon.style.display = 'none'; // Initially hide the delete icon
        deleteIcon.addEventListener('click', function () {
            deleteChat(chatDetails, newChatText);
            newChatText.style.backgroundColor = '#ccc';
        });


        // Append the new element and delete icon to the sidebar
        newChatText.appendChild(deleteIcon);
        document.querySelector('.sidebar').insertBefore(newChatText, document.querySelector('.text'));

        // Apply styling to the recently created "New Chat" text
        newChatText.style.backgroundColor = '#ccc';
        newChatText.style.border = "1px solid #bbb"
        document.getElementById("currentchat").style.backgroundColor = "whitesmoke"

        // Store the chat details in the array
        chatData.push(chatDetails);

        // Store newChatCounter and chatData in localStorage
        localStorage.setItem('newChatCounter', newChatCounter);
        localStorage.setItem('chatData', JSON.stringify(chatData));

        // Toggle delete icons on hover for the new chat text
        newChatText.addEventListener('mouseover', function () {
            deleteIcon.style.display = 'inline';
        });

        newChatText.addEventListener('mouseout', function () {
            deleteIcon.style.display = 'none';
        });

        activeNewChat.addEventListener('mouseover', function () {
            activeNewChat.style.backgroundColor = "#ddd"
        });

        activeNewChat.addEventListener('mouseout', function () {
            activeNewChat.style.backgroundColor = "whitesmoke"
        });


        // Hide the delete icon of the previous new chat
        if (activeNewChat) {
            var previousDeleteIcon = activeNewChat.querySelector('.delete-icon');
            if (previousDeleteIcon) {
                previousDeleteIcon.style.display = 'none';
                activeNewChat.style.backgroundColor = 'whitesmoke';
            }
        }
    } else {
        activeNewChat.style.backgroundColor = '#ccc';
    }
}



    // Call this function to initialize the chatData and newChatCounter on page load
    function initializeChatData() {
    // Add existing chats from chatData
    chatData.slice(0, 10).forEach(function (chatDetails) {
    // Use the addChatToSidebar function to add each chat to the sidebar
    addChatToSidebar(chatDetails);
        
    });
    }

    // Function to add a chat to the sidebar
    function addChatToSidebar(chatInfo) {
    var newChatText = document.createElement('div');
    newChatText.classList.add('days', 'new-chat-text');
    newChatText.innerHTML = chatInfo.name; // Adjust this based on your chatInfo structure

    // Append the new element to the sidebar
    document.querySelector('.sidebar').insertBefore(newChatText, document.querySelector('.text'));
    }

    // Call the function to initialize chat data
    initializeChatData();

        function openNav() {
        document.getElementById("sticky-top").style.top = "0";
        document.getElementById("mainContainer").style.marginLeft = "13.5%";
        document.getElementById("sidebar").style.marginLeft = "0";
        document.getElementById("howcan").style.marginLeft = "36%";
    }

    function closeNav() {
        document.getElementById("sticky-top").style.top = "-85px";
        document.getElementById("mainContainer").style.marginLeft = "0";
        document.getElementById("sidebar").style.marginLeft = "-13.5%";
        document.getElementById("howcan").style.marginLeft = "30%";
    }

    function slideUpStickyTop() {
        var stickyTop = document.getElementById('sticky-top');
        stickyTop.style.transition = 'top 0.5s ease'; // Smooth transition effect
        stickyTop.style.top = '-85px'; // Adjust the value for the desired slide-up distance
    }

    function slideDownStickyTop() {
        var stickyTop = document.getElementById('sticky-top');
        stickyTop.style.transition = 'top 0.5s ease'; // Smooth transition effect
        stickyTop.style.top = '0';
    }
    function sendMessage() {
    var userInput = document.getElementById('userInput').value.trim(); // Trim leading and trailing whitespace
    if (userInput !== '') {
        appendMessage('user', userInput);

        // Simulate AI typing before sending the response
        simulateTyping();

        // Send the user's message to the Flask server
        fetch('http://127.0.0.1:5000/api/ai', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ message: userInput }),
        })
        .then(response => response.json())
        .then(data => {
            // Assuming the server responds with the AI's message
            var aiResponse = data.message;

            // Stop simulating typing before showing the AI response
            stopTyping();

            // Display AI response with typing animation
            displayWithTyping('bot', aiResponse);
        })
        .catch(error => console.error('Error:', error));

        // Clear the user input field
        hidehowcan();
        document.getElementById('userInput').value = '';
        document.getElementById('sendButton').style.backgroundColor = "gray";
    }
}


        function simulateTyping() {
            var chatBox = document.getElementById('chatBox');
            var typingIndicator = document.createElement('div');
            typingIndicator.classList.add('bot', 'typing-animation');
            typingIndicator.innerHTML = 'AI is typing...';
            chatBox.appendChild(typingIndicator);
        }

        function stopTyping() {
            var chatBox = document.getElementById('chatBox');
            var typingIndicator = chatBox.querySelector('.typing-animation');
            if (typingIndicator) {
                chatBox.removeChild(typingIndicator);
            }
        }

        function displayWithTyping(sender, message) {
            var chatBox = document.getElementById('chatBox');
            var messageElement = document.createElement('div');
            messageElement.classList.add(sender);

            var senderText = sender === 'user' ? 'You' : '🤖';
            messageElement.innerHTML = `<strong>${senderText}:</strong> `;

            // Split the message into characters and display one by one with typing effect
            message.split('').forEach((char, index) => {
                setTimeout(() => {
                    messageElement.innerHTML += char;
                    chatBox.scrollTop = chatBox.scrollHeight; // Scroll to the bottom
                }, index * 10); // Adjust the timing as needed
            });

            // Add the message element to the chat box
            chatBox.appendChild(messageElement);
        }

        function appendMessage(sender, message) {
        var chatBox = document.getElementById('chatBox');
        var messageElement = document.createElement('div');
        messageElement.classList.add(sender);

        var senderText = sender === 'user' ? 'You' : 'AI';

        // Add spacing between messages
        var spacer = document.createElement('div');
        spacer.classList.add('spacer');
        chatBox.appendChild(spacer);

        messageElement.innerHTML = `<strong>${senderText}:</strong> ${message}`;
        chatBox.appendChild(messageElement);

        // Add a class for AI messages
        if (sender === 'bot') {
            messageElement.classList.add('ai-message');
        }

        // Scroll to the bottom to show the latest message
        chatBox.scrollTop = chatBox.scrollHeight;

    }
        // Function to start voice recognition
        function startVoiceRecognition() {
            var recognition = new webkitSpeechRecognition() || SpeechRecognition();
            recognition.lang = 'en-US';

            recognition.onresult = function (event) {
                var result = event.results[0][0].transcript;
                document.getElementById('userInput').value = result;
            };

            recognition.start();
        }

        // Function to reset chat box content
        function resetChat() {
            var chatBox = document.getElementById('chatBox');
            chatBox.innerHTML = ''; // Clear the inner HTML of the chat box
            setTimeout(function () {
            displayWelcomeMessage();
            }, 1000);
        }

        function resetChat2() {
            var chatBox = document.getElementById('chatBox');
            chatBox.innerHTML = ''; // Clear the inner HTML of the chat box
        }

        function hoverOpenBtn() {
            document.querySelector('.open-btn').innerHTML = '❱';
        }

        function unhoverOpenBtn() {
            document.querySelector('.open-btn').innerHTML = '❱';
        }

        function slideUpStickyTop() {
            var stickyTop = document.getElementById('sticky-top');
            stickyTop.style.transition = 'top 0.5s ease'; // Smooth transition effect
            stickyTop.style.top = '-85px'; // Adjust the value for the desired slide-up distance
        }

        function slideDownStickyTop() {
            var stickyTop = document.getElementById('sticky-top');
            stickyTop.style.transition = 'top 0.5s ease'; // Smooth transition effect
            stickyTop.style.top = '0';
        }

        function showNameInput() {
            // Display the name input modal
            document.getElementById('nameModal').style.display = 'flex';

            // Slide up the sticky-top during name input
            slideUpStickyTop();
        }

        function hideNameInput() {
            // Hide the name input modal
            document.getElementById('nameModal').style.display = 'none';

            // Slide down the sticky-top after name input
            slideDownStickyTop();
        }

        function slideDownAfterLogout() {
            // Slide down the sticky-top after logout
            slideDownStickyTop();
        }

        // Check if the user is already logged in
        var loggedInUser = localStorage.getItem('loggedInUser');
        var userSection = document.getElementById('userSection');
        var loggedInUserElement = document.getElementById('loggedInUser');
        var nameModal = document.getElementById('nameModal');

        // Initialize sticky-top state based on user login status
        if (loggedInUser) {
            // User is logged in
            userSection.style.display = 'block';
            loggedInUserElement.textContent = 'Logged in as: ' + loggedInUser;
            nameModal.style.display = 'none';

            // After login, slide down the sticky-top
            showhowcan();
            slideDownStickyTop();
        } else {
            // User is not logged in, slide up the sticky-top
            loginslideopen();
            loginslideopenRight();
            slideUpStickyTop();
        }

        // Function to handle login
        function login() {
            var username = document.getElementById('username').value;
            if (username.trim() !== '') {
                localStorage.setItem('loggedInUser', username);
                userSection.style.display = 'block';
                loggedInUserElement.textContent = 'Logged in as: ' + username;
                nameModal.style.display = 'none';

                // After login, slide down the sticky-top
                loginslideclose();
                loginslidecloseRight();
                setTimeout(function () {
                openNav();
                slideDownStickyTop();
                }, 300);
                setTimeout(function () {
                showhowcan();
                document.getElementById("user-input").style.display = "flex"
                document.getElementById("disclaimer").style.display = "flex"
                }, 700);
                resetChat2();
                setTimeout(function () {
                displayWelcomeMessage2();
                }, 1000);
            }
        }

        function logout() {
        closeNav();
        setTimeout(function () {
        loginslideopen();
        loginslideopenRight();
        }, 300);
        document.getElementById("user-input").style.display = "none"
        document.getElementById("disclaimer").style.display = "none"
        // Clear the newChatCounter, chatData, and loggedInUser from localStorage
        localStorage.removeItem('newChatCounter');
        localStorage.removeItem('chatData');
        localStorage.removeItem('loggedInUser');

        // Reset the newChatCounter and chatData array
        newChatCounter = 1;
        chatData = [];

        // Remove the 'active' class and background color from the previously active "New Chat" text
        var activeNewChat = document.querySelector('.new-chat-text.active');
        if (activeNewChat) {
            activeNewChat.classList.remove('active');
            activeNewChat.style.backgroundColor = ''; // Reset background color
        }

        // Clear the chat box
        resetChat2();

        // Remove all new chat elements from the sidebar
        var sidebar = document.querySelector('.sidebar');
        var newChatElements = document.querySelectorAll('.new-chat-text');
        newChatElements.forEach(function (element) {
            sidebar.removeChild(element);
        });

        // Slide up the sticky-top after logout
        userSection.style.display = 'none';
        nameModal.style.display = 'flex';
        slideUpStickyTop();
        }

        function deleteChat(chatDetails, chatElement) {
    // Remove the chat from chatData array
    chatData = chatData.filter(chat => chat.counter !== chatDetails.counter);

    // Remove the chat element from the sidebar
    var sidebar = document.querySelector('.sidebar');
    sidebar.removeChild(chatElement);

    // If the deleted chat was the currently active one, reset the chat box
    if (chatElement.classList.contains('active')) {
        resetChat2();
    }

    // If no more new chats exist, reset the new chat counter to 1
    if (chatData.length === 0) {
        newChatCounter = 1;
        // Give #ccc background color to the #currentchat text
        document.getElementById('currentchat').style.backgroundColor = '#ccc'
    }

    // Store updated chatData in localStorage
    localStorage.setItem('chatData', JSON.stringify(chatData));
    localStorage.setItem('newChatCounter', newChatCounter);

    // Get the previous new chat element and give it the #ccc background color
    var newChatElements = sidebar.querySelectorAll('.new-chat-text');
    var previousNewChat = newChatElements[newChatElements.length - 1];

    if (previousNewChat) {
        previousNewChat.style.backgroundColor = '#ccc';
        previousNewChat.style.transition = 'background-color 0.5s ease';
        previousNewChat.classList.add('active'); // Add 'active' class to make it active

        // Reset the chat box and display a welcome message
        resetChat();

        var chatBox = document.getElementById('chatBox');

        // Simulate AI typing before showing the welcome message
        simulateTyping();

        // Display the welcome message with typing animation
        displayWithTyping('bot', 'You created a new chat. How can I help you?');

        // Stop simulating typing after showing the welcome message
        stopTyping();

        // Scroll to the bottom to show the latest message
        chatBox.scrollTop = chatBox.scrollHeight;
    }
}

function showDeleteIcon(chatId) {
    var deleteIcon = document.querySelector('.delete-icon[data-chat-id="' + chatId + '"]');
    if (deleteIcon) {
        deleteIcon.style.display = 'inline-block';
    }
}

function hideAllDeleteIcons() {
    var deleteIcons = document.querySelectorAll('.delete-icon');
    deleteIcons.forEach(function (icon) {
        icon.style.display = 'none';
    });
}
        //Function to handle delete icon click
        function handleDeleteClick(deleteIcon) {
            // Your logic to handle delete click
            console.log('Delete icon clicked!');
            // For example, you can remove the entire chat item
            deleteIcon.parentNode.remove();
        }

        // Function to toggle delete icons on chat item hover
        function toggleDeleteIcons() {
            const chatList = document.getElementById('chatList');
            const chatItems = chatList.querySelectorAll('li');

            chatItems.forEach(chatItem => {
                chatItem.addEventListener('mouseover', () => {
                    const deleteIcon = chatItem.querySelector('.delete-icon');
                    deleteIcon.style.display = 'inline';
                });

                chatItem.addEventListener('mouseout', () => {
                    const deleteIcon = chatItem.querySelector('.delete-icon');
                    deleteIcon.style.display = 'none';
                });
            });
        }

        // Call the function to set up event listeners
        toggleDeleteIcons();
    </script>
</body>
</html>
